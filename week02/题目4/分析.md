# 题目4

[TOC]

 根据上述自己对于 1 和 2 的演示，写一段对于不同 GC 和堆内存的总结，提交到 GitHub。 

## 前言

已经在题目1中，进行了4类GC，设置堆内存分别从128M,256M,512M,1G,2G,4G进行log输出。

## SerialGC

### 日志分析

第一次执行时，将xmx,xms都设置为128M。程序很快就发生Exception in thread "main" java.lang.OutOfMemoryError: Java heap space的异常并退出。

由于堆内存过小，在短暂的几次 GC后进行持续的full GC,直到oom异常而程序退出。

从日志来看，Minor GC最后一次是0.0000135 s，其他情况下基本处于7ms范围。Full GC最大一次0.0180589s,即18ms。

发生Minor GC8次，FULL GC 25次。

到256M时，依旧发生了oom异常，次数Minor  GC次数变成10次，FULL GC达到30次。说明随着堆内存设置的上涨，蓄水池升高，允许Minor  GC发生的次数则变多了。而且第一次GC回收时，回收明显比128M更多，而且回收的内存数量也越大，最大一次达到了15.8ms，比128M时花费更长。

这时候Full GC也是如此，最大一次高达0.0329157s,即32.9ms。



提升到512M时，情况明显提升，而且不出现oom的异常，而且不出现Full GC,Minor GC次数达到17次，其中对老年代也进行了回收。而回收时间也明显升高，最高一次达到31.3ms。



继续提升堆内存大小到1G。Minor GC达到10次，此时回收时间最高达到了52.4ms。

提到到2G时，Minor GC明显降低为4次，此时回收时间最高达到了87.5ms。

而提升到4G时，Minor GC明显降低位2次，而回收停顿时间达到了141ms。

### 总结

当内存不够程序完整执行时，会发生频繁的Minor GC和Full GC，直到oom。随着堆内存不断增加，Full GC次数会逐步减少，直至不存在，而Minor GC的次数可能会存在先增加后减少的情况（因为没有Full GC的情况后，基本靠Minor GC进行垃圾回收），而GC回收单次耗费的时间有所曾增加，回收数量也随之增大。



## ParallelGC

### 日志分析

128M时也发生oom情况。Minor GC次数10次， 比串行GC要多，而且基本在4ms以内，因为我本机电脑属于多核，所以回收频率要比串行的高。而Full GC也比串行快，最高一次是12ms左右。

随后升到256M，依旧发生oom。和串行一样，Minor GC发生次数增多，基本在8ms以内，Full GC发生次数也随之增多,最高时候达到22ms。

到了512M后，不发生oom，此时在发生一段GC后，发现发生Minor GC和Full GC交替执行，最大的Minor GC时间达到36.8ms，Full GC达到31.7ms。

到了1G后，Full GC次数下降为2次，处于37ms左右，Minor GC高达22次，最高24.7ms。

到了2G后，Full GC已经不存在了，Minor GC次数也随之减少，最高达到45ms。

到了4G后，Minor GC次数降低为2次，时间最高达到61ms。

### 总结

随着堆内存增大，Full GC次数出现频率变低，甚至为0。Minor GC也呈现先增后减的趋势，时间也随之降低，但比SerialGC更快。





## CMS GC

### 日志分析

128M也是发生oom。在CMS初始阶段很快，而且期间会发生多次Minor GC和Full GC。

值得一提的是，当变成256M时，竟然没有像Serial GC或者ParallerGC那般oom。猜测是，CMS能在重新标记阶段快速又把更多无效不可达对象标记住，而且又快速的清理才达到的效果。或者是本次执行的时候，巧好没达到堆内存上限。而且在GC回收时间说明显比128M更高了。而且这一次创建对象的数量降低为5000以下。

512M时，GC时间也是明显提升，GC回收阶段中，相比同内存下的ParallerGC花费时间短。

1G时，明显GC次数降低，而花费时间也随之上涨。而2GB时，也是不存在Full GC的时候。GC次数再次减少。升到4GB时，GC时间没有显著增加，似乎持平。花费均值也处于持平状态。

### 总结

随着堆内存增大，Full GC次数出现频率变低，甚至为0。Minor GC也呈现先增后减的趋势。增大堆内存并不意味着花费时间的成倍上升。感觉堆内存增加达到一定阶段后，CMS并没有多大提升。内存较少的情况下，有时候表现比ParallerGC和Serial GC好。

## G1GC

### 日志分析

128M时照样发生oom。但是发现发生Minor GC耗时却比Serial GC表现良好。

256M也还是发生oom。此时Minor GC单次耗时存在下降的趋势，而发生次数却上升。达到512M时，Minor GC又略微上升，比128M回收时间短。性能看起来比前面三类GC好些。

随着内存增大，发生GC次数明显减少。随着内存增加，GC时间有上涨，但比其他三类GC明显单次耗费时间更少。

### 总结

随着堆内存的上涨，G1性能与其他GC相比，性能差距越来越大。



## 整体总结

- Serial GC是老版本的Java的收集器，效率在如今多核的情况下，和其他GC比并不优秀。耗费时间比较长。

- 随着堆内存的上涨，各个GC发生Full GC的次数和频率降低，G1则内存越大，似乎性能越好。

- 堆内存达到一定程度，CMS的性能并没有多大提示，在内存紧张的情况下，有可能CMS 比Paraller表现更好。

  







































